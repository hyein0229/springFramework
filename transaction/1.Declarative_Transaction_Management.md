# 선언적 트랜잭션 관리(Declarative Transaction Management)
>대부분의 스프링 프레임워크 사용자가 선언적 트랜잭션 방식을 사용한다.<br>
>선언적 트랜잭션 방식은 가장 애플리케이션 코드에 미치는 영향이 적으므로 비침투적인 경량 컨테이너인 스프링의 이상과 매우 일치하다.
>

- 스프링의 선언적 트랜잭션 관리 방식은 Spring AOP 기반으로 구현된다.
- 트랜잭션 AOP 코드(@Transactional)는 기본적으로 스프링 프레임워크엣 제공하며 보일러플레이트 방식으로 쉽게 사용되므로, AOP 에 대한 개념을 깊게 몰라도 효과적으로 사용이 가능하다.

**EJB CMT와의 유사점**
- 먼저, EJB CMT 란? Enterprise JavaBeans Container-Managed Transaction
    - Java EE 에서 제공하는 컨테이너 기반 트랜잭션 관리 방식
- Spring 의 선언적 트랜잭션 관리는 EJB CMT 와 유사하게 각 메서드 수준에서 트랜잭션 동작을 설정할 수 있다.
- 그리고, 트랜잭션 컨텍스트 내에서 setRollbackOnly() 를 호출하여 롤백을 수행하도록 할 수 있다.

**EJB CMT와의 차이점**
- 환경의 독립성
    - EJB CMT 는 JTA 환경에 묶여있다.
    - Spring 은 JPA, JDBC, hibernate 등 다양한 데이터 접근 기술 환경에서 동작한다.
    - 설정 파일만 수정하면 된다.
- 특수 클래스에 제한 없이 어떤 클래스에도 선언적 트랜잭션을 적용할 수 있다.
- 선언적 롤백 규칙 지원
    - 선언적 방식, 프로그래밍 방식 모두 롤백 규칙을 지원한다.
- AOP 를 사용하여 트랜잭션 동작 커스터마이징이 가능하다.
    - transaction rollback 시점에 커스텀 로직을 추가하거나
    - transaction AOP 와 함께 다른 Advice 를 추가로 같이 쓸 수 있다.
    - EJB 는 setRollbackOnly() 외엔 트랜잭션 관리에 어떤 영향도 줄 수 없다.
- 원격 호출 간 트랜잭션 전파를 지원하지 않는다.
    - 이것이 필요하면 EJB 를 사용해야 한다.
    - 하지만, 보통은 트랜잭션이 원격 호출까지 전파되는 것은 바람직하지 않다.

## rollback rules(롤백 규칙)
- 롤백 규칙은 중요하다.
- 어떤 예외가 터졌을 때 자동 롤백을 수행하도록 할 것인지 정할 수 있도록 한다.
- 롤백 규칙은 자바 코드가 아닌 설정 파일에 지정할 수 있다.
- 이 방식은 비즈니스 로직이 트랜잭션 인프라(즉, 스프링 트랜잭션 API)에 직접 의존하지 않아도 된다는 것이다.

**기본 롤백 동작**
- EJB 의 기본 동작은 시스템(주로 런타임 예외)가 터졌을 때 자동 롤백하는 것이다.
- Spring 도 이처럼 비검사 예외(런타임 예외)에만 자동 롤백을 수행하도록 하지만, 스프링은 이 동작을 커스텀할 수 있다.
